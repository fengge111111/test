<html>
<head>
    <title>Html-Qrcode Demo</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>
<style>
	#start-button{
		width: 50vw;
		height: 30vw;
	}
</style>
<body>
    <div id="qr-reader" style="width:500px"></div>
    <button id="start-button">开始扫码</button>
	 <div id="qr-reader-results"></div>
    <script src="./html5-qrcode.min.js"></script>
    <script>
        function docReady(fn) {
            if (document.readyState === "complete" || document.readyState === "interactive") {
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        }
		
		const config = {
		  fps: 10, //  二维码扫描每秒帧数
		  qrbox: { width: 300, height: 300 }, // UI框的大小
		  aspectRatio: 1.777778,  // 纵横比,此值表示全屏
		}

        docReady(function () {
			var html5QrCode = new Html5Qrcode("qr-reader")
			var lastResult, countResults = 0;
			function onScanSuccess(decodedText, decodedResult) {
					$("#qr-reader-results").html(decodedText)
					html5QrCode.stop();
					html5QrCode.clear();
			}
			// 获取相机设备
			var mydevices=null;
			Html5Qrcode.getCameras()
			  .then(devices => {
				  mydevices = devices
			  })
			  .catch(err => {
			    alert(err)
			  })
            $('#start-button').click(function() {
                // 扫码配置
                
                if (mydevices && mydevices.length) {
                  const cameraId = mydevices[mydevices.length - 1].id //后置摄像头，一般最后一个是后置摄像头
                  //let cameraId = devices[0].id //前置摄像头
                  // 打开相机，开始扫描，callbackSuccess, callbackFailure扫描成功与失败的回调函数（自行定义）
                  html5QrCode.start({ deviceId: { exact: cameraId } }, config, onScanSuccess).catch(err => {
                    alert(err)
                  })
				} else {
				    // 如果没有找到设备，直接启用摄像头
				    //environment：后置摄像头  user：前置摄像头
				    html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess).catch(err => {
				      alert(err)
				    })
				}
            });
        });
    </script>
</body>
</html>
